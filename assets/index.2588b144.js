import{F as G,G as $,_ as q,I as Y,u as _,r as m,j as e,B as P,J as k,A as V,c as H,o as J,d as A,x as K,K as X,H as Q,C as D,M as Z,O as W,e as ee}from"./index.a9df0b2a.js";import{I as S}from"./Input.e9cfbcbb.js";import{u as w}from"./user.api.df0a564b.js";import{I as se}from"./InputNumber.77770957.js";import{t as te}from"./toNumber.07e70fc9.js";var re=Math.ceil,ae=Math.max;function oe(s,t,r,a){for(var x=-1,d=ae(re((t-s)/(r||1)),0),i=Array(d);d--;)i[a?d:++x]=s,s+=r;return i}var ne=oe,ie=G,le=$,de=q,ce=Y;function xe(s,t,r){if(!ce(r))return!1;var a=typeof t;return(a=="number"?le(r)&&de(t,r.length):a=="string"&&t in r)?ie(r[t],s):!1}var me=xe,pe=te,R=1/0,he=17976931348623157e292;function ue(s){if(!s)return s===0?s:0;if(s=pe(s),s===R||s===-R){var t=s<0?-1:1;return t*he}return s===s?s:0}var fe=ue,ge=ne,je=me,N=fe;function be(s){return function(t,r,a){return a&&typeof a!="number"&&je(t,r,a)&&(r=a=void 0),t=N(t),r===void 0?(r=t,t=0):r=N(r),a=a===void 0?t<r?1:-1:N(a),ge(t,r,a,s)}}var ve=be,we=ve,Ne=we(),ye=Ne;const y=ye;function _e({value:s,onChange:t,errorMessage:r}){const{t:a}=_(),[x,d]=m.exports.useState({date:f.getDate(),month:f.getMonth(),year:f.getFullYear()});m.exports.useEffect(()=>{s&&d({date:s.getDate(),month:s.getMonth(),year:s.getFullYear()})},[s]);const i=n=>{const{value:c,name:g}=n.target,h={...x,[g]:c};d(h),t&&t(new Date(h.year,h.month,h.date))};return e.exports.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:a("date of birth")}),e.exports.jsxs("div",{className:"sm:w-[80%] sm:pl-5",children:[e.exports.jsxs("div",{className:"flex justify-between",children:[e.exports.jsxs("select",{onChange:i,name:"date",className:"h-10 w-[32%] rounded-sm border border-black/10 px-3",value:(s==null?void 0:s.getDate())||x.date,children:[e.exports.jsx("option",{disabled:!0,children:a("day")}),y(1,32).map(n=>e.exports.jsx("option",{value:n,children:n},n))]}),e.exports.jsxs("select",{onChange:i,name:"month",className:"h-10 w-[32%] rounded-sm border border-black/10 px-3",value:(s==null?void 0:s.getMonth())||x.month,children:[e.exports.jsx("option",{disabled:!0,children:a("month")}),y(0,12).map(n=>e.exports.jsx("option",{value:n,children:n+1},n))]}),e.exports.jsxs("select",{onChange:i,name:"year",className:"h-10 w-[32%] rounded-sm border border-black/10 px-3",value:(s==null?void 0:s.getFullYear())||x.year,children:[e.exports.jsx("option",{disabled:!0,children:a("year")}),y(1950,2025).map(n=>e.exports.jsx("option",{value:n,children:n},n))]})]}),e.exports.jsx("div",{className:"mt-1 min-h-[1.25rem] text-sm text-red-600",children:r})]})]})}const Ce=1048576;function Ie({onChange:s}){const{t}=_(),r=m.exports.useRef(null),a=d=>{var i;d.preventDefault(),(i=r.current)==null||i.click()},x=d=>{var n;const i=(n=d.target.files)==null?void 0:n[0];i&&(i.size>=Ce||!i.type.includes("image"))?k.error("D\u1EE5ng l\u01B0\u1EE3ng file t\u1ED1i \u0111a 1 MB. \u0110\u1ECBnh d\u1EA1ng:.JPEG, .PNG",{position:"top-center"}):s&&s(i)};return e.exports.jsxs(m.exports.Fragment,{children:[e.exports.jsx("input",{className:"hidden",type:"file",accept:".jpg,.jpeg,.png",ref:r,onChange:x,onClick:d=>d.target.value=null}),e.exports.jsx(P,{buttonType:"secondary",className:"h-10 rounded-sm border px-6 text-gray-600 shadow-sm",onClick:a,children:t("select image")})]})}const Fe=W.pick(["name","address","phone","date_of_birth","avatar"]),f=new Date(1990,0,1);function Pe(){const{t:s}=_(),[t,r]=m.exports.useState(),a=m.exports.useMemo(()=>t?URL.createObjectURL(t):"",[t]),{setProfile:x}=m.exports.useContext(V),{control:d,register:i,handleSubmit:n,setValue:c,watch:g,formState:{errors:h,isValid:L}}=H({defaultValues:{name:"",phone:"",address:"",avatar:"",date_of_birth:f},resolver:J(Fe),mode:"onBlur"}),C=A({mutationFn:w.updateProfile,onSuccess:l=>{k.success(l.data.message,{position:"top-center",autoClose:1e3})}}),I=A({mutationFn:w.uploadAvatar}),{data:v,refetch:z}=K({queryKey:["profile"],queryFn:w.getProfile}),o=v==null?void 0:v.data.data,F=g("avatar"),B=()=>{const{name:l,phone:b,address:p,date_of_birth:u}=g();return o&&l===o.name&&b===o.phone&&p===o.address&&F===o.avatar&&(u==null?void 0:u.toISOString())===o.date_of_birth},M=C.isPending||I.isPending,O=M||!L||B();m.exports.useEffect(()=>{o&&(c("name",o.name),c("phone",o.phone),c("address",o.address),c("avatar",o.avatar),c("date_of_birth",o.date_of_birth?new Date(o.date_of_birth):f))},[o]);const T=l=>{r(l),c("avatar",URL.createObjectURL(l))},U=n(async l=>{var b;try{let p=F;if(t){const E=new FormData;E.append("image",t),p=(await I.mutateAsync(E)).data.data,c("avatar",p)}const u=await C.mutateAsync({...l,avatar:p,date_of_birth:(b=l.date_of_birth)==null?void 0:b.toISOString()});x(u.data.data),X(u.data.data),z()}catch(p){console.log(p)}}),j=l=>ee(h,l);return e.exports.jsxs("div",{className:"rounded-sm bg-white px-2 pb-10 shadow md:px-7 md:pb-20",children:[e.exports.jsxs(Q,{children:[e.exports.jsxs("title",{children:[s("my profile")," | Shopee Clone"]}),e.exports.jsx("meta",{name:"description",content:"Trang th\xF4ng tin c\xE1 nh\xE2n"})]}),e.exports.jsxs("div",{className:"border-b border-b-gray-200 py-6",children:[e.exports.jsx("h1",{className:"text-lg font-medium capitalize text-gray-900",children:s("my profile")}),e.exports.jsx("div",{className:"mt-1 text-sm text-gray-700",children:s("protect account")})]}),e.exports.jsxs("form",{className:"mt-8 flex flex-col-reverse md:flex-row md:items-start",onSubmit:U,children:[e.exports.jsxs("div",{className:"mt-6 flex-grow md:mt-0 md:pr-12",children:[e.exports.jsxs("div",{className:"flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:s("email")}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx("div",{className:"pt-3 text-gray-700",children:o==null?void 0:o.email})})]}),e.exports.jsxs("div",{className:"mt-6 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:s("name")}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx(S,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",name:"name",placeholder:s("name"),errorMessage:j("name"),setValue:c,register:i})})]}),e.exports.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:s("phone")}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx(D,{control:d,name:"phone",render:({field:l})=>e.exports.jsx(se,{type:"text",placeholder:s("phone"),classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",errorMessage:j("phone"),...l,onChange:l.onChange})})})]}),e.exports.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:s("address")}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx(S,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",name:"address",placeholder:s("address"),errorMessage:j("address"),setValue:c,register:i})})]}),e.exports.jsx(D,{control:d,name:"date_of_birth",render:({field:l})=>e.exports.jsx(_e,{errorMessage:j("date_of_birth"),value:l.value,onChange:l.onChange})}),e.exports.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right"}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx(P,{className:"h-9 rounded-sm px-5",type:"submit",loading:M,disabled:O,children:s("save")})})]})]}),e.exports.jsx("div",{className:"flex justify-center md:w-72 md:border-l md:border-l-gray-200",children:e.exports.jsxs("div",{className:"flex flex-col items-center",children:[e.exports.jsx("div",{className:"my-5 h-24 w-24",children:e.exports.jsx("img",{src:a||Z(o==null?void 0:o.avatar),alt:"",className:"h-full w-full rounded-full border border-black/10 object-cover"})}),e.exports.jsx(Ie,{onChange:T}),e.exports.jsxs("div",{className:"mt-3 text-gray-400",children:[e.exports.jsx("div",{children:s("file size max")}),e.exports.jsx("div",{children:s("file extension format")})]})]})})]})]})}export{Pe as default};
