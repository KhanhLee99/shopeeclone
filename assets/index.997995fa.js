import{u as ke,O as Ce,r as y,A as ze,q as Oe,d as Q,h as W,j as c,H as Se,L as re,t as se,v as N,Q as Ae,K as O,B as Fe,M as ne}from"./index.4e17b61c.js";import{B as De}from"./Button.d45faafc.js";import{Q as Ee}from"./QuantityController.54fcbbba.js";import{P as Me}from"./PurchaseSkeleton.23487e6a.js";import"./InputNumber.5fc647f3.js";var Be=Object.defineProperty,ce=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,oe=(e,t,r)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Te=(e,t)=>{for(var r in t||(t={}))Ie.call(t,r)&&oe(e,r,t[r]);if(ce)for(var r of ce(t))Re.call(t,r)&&oe(e,r,t[r]);return e},fe=Symbol.for("immer-nothing"),ie=Symbol.for("immer-draftable"),p=Symbol.for("immer-state");function x(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var P=Object.getPrototypeOf;function v(e){return!!e&&!!e[p]}function j(e){var t;return e?pe(e)||Array.isArray(e)||!!e[ie]||!!((t=e.constructor)!=null&&t[ie])||M(e)||B(e):!1}var qe=Object.prototype.constructor.toString();function pe(e){if(!e||typeof e!="object")return!1;const t=P(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===qe}function A(e,t){E(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,s)=>t(s,r,e))}function E(e){const t=e[p];return t?t.type_:Array.isArray(e)?1:M(e)?2:B(e)?3:0}function G(e,t){return E(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function me(e,t,r){const s=E(e);s===2?e.set(t,r):s===3?e.add(r):e[t]=r}function Ke(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function M(e){return e instanceof Map}function B(e){return e instanceof Set}function g(e){return e.copy_||e.base_}function L(e,t){if(M(e))return new Map(e);if(B(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&pe(e))return P(e)?Te({},e):Object.assign(Object.create(null),e);const r=Object.getOwnPropertyDescriptors(e);delete r[p];let s=Reflect.ownKeys(r);for(let n=0;n<s.length;n++){const a=s[n],d=r[a];d.writable===!1&&(d.writable=!0,d.configurable=!0),(d.get||d.set)&&(r[a]={configurable:!0,writable:!0,enumerable:d.enumerable,value:e[a]})}return Object.create(P(e),r)}function Z(e,t=!1){return I(e)||v(e)||!j(e)||(E(e)>1&&(e.set=e.add=e.clear=e.delete=Qe),Object.freeze(e),t&&Object.entries(e).forEach(([r,s])=>Z(s,!0))),e}function Qe(){x(2)}function I(e){return Object.isFrozen(e)}var We={};function b(e){const t=We[e];return t||x(0,e),t}var w;function xe(){return w}function Ue(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ae(e,t){t&&(b("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function X(e){$(e),e.drafts_.forEach(He),e.drafts_=null}function $(e){e===w&&(w=e.parent_)}function le(e){return w=Ue(w,e)}function He(e){const t=e[p];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function de(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[p].modified_&&(X(t),x(4)),j(e)&&(e=F(t,e),t.parent_||D(t,e)),t.patches_&&b("Patches").generateReplacementPatches_(r[p].base_,e,t.patches_,t.inversePatches_)):e=F(t,r,[]),X(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==fe?e:void 0}function F(e,t,r){if(I(t))return t;const s=t[p];if(!s)return A(t,(n,a)=>ue(e,s,t,n,a,r)),t;if(s.scope_!==e)return t;if(!s.modified_)return D(e,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const n=s.copy_;let a=n,d=!1;s.type_===3&&(a=new Set(n),n.clear(),d=!0),A(a,(u,h)=>ue(e,s,n,u,h,r,d)),D(e,n,!1),r&&e.patches_&&b("Patches").generatePatches_(s,r,e.patches_,e.inversePatches_)}return s.copy_}function ue(e,t,r,s,n,a,d){if(v(n)){const u=a&&t&&t.type_!==3&&!G(t.assigned_,s)?a.concat(s):void 0,h=F(e,n,u);if(me(r,s,h),v(h))e.canAutoFreeze_=!1;else return}else d&&r.add(n);if(j(n)&&!I(n)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;F(e,n),(!t||!t.scope_.parent_)&&typeof s!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,s)&&D(e,n)}}function D(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Z(t,r)}function Ge(e,t){const r=Array.isArray(e),s={type_:r?1:0,scope_:t?t.scope_:xe(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=s,a=V;r&&(n=[s],a=k);const{revoke:d,proxy:u}=Proxy.revocable(n,a);return s.draft_=u,s.revoke_=d,u}var V={get(e,t){if(t===p)return e;const r=g(e);if(!G(r,t))return Le(e,r,t);const s=r[t];return e.finalized_||!j(s)?s:s===U(e.base_,t)?(H(e),e.copy_[t]=Y(s,e)):s},has(e,t){return t in g(e)},ownKeys(e){return Reflect.ownKeys(g(e))},set(e,t,r){const s=he(g(e),t);if(s!=null&&s.set)return s.set.call(e.draft_,r),!0;if(!e.modified_){const n=U(g(e),t),a=n==null?void 0:n[p];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Ke(r,n)&&(r!==void 0||G(e.base_,t)))return!0;H(e),J(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return U(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,H(e),J(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=g(e),s=Reflect.getOwnPropertyDescriptor(r,t);return s&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:s.enumerable,value:r[t]}},defineProperty(){x(11)},getPrototypeOf(e){return P(e.base_)},setPrototypeOf(){x(12)}},k={};A(V,(e,t)=>{k[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});k.deleteProperty=function(e,t){return k.set.call(this,e,t,void 0)};k.set=function(e,t,r){return V.set.call(this,e[0],t,r,e[0])};function U(e,t){const r=e[p];return(r?g(r):e)[t]}function Le(e,t,r){var s;const n=he(t,r);return n?"value"in n?n.value:(s=n.get)==null?void 0:s.call(e.draft_):void 0}function he(e,t){if(!(t in e))return;let r=P(e);for(;r;){const s=Object.getOwnPropertyDescriptor(r,t);if(s)return s;r=P(r)}}function J(e){e.modified_||(e.modified_=!0,e.parent_&&J(e.parent_))}function H(e){e.copy_||(e.copy_=L(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Xe=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,s)=>{if(typeof t=="function"&&typeof r!="function"){const a=r;r=t;const d=this;return function(h=a,...C){return d.produce(h,z=>r.call(this,z,...C))}}typeof r!="function"&&x(6),s!==void 0&&typeof s!="function"&&x(7);let n;if(j(t)){const a=le(this),d=Y(t,void 0);let u=!0;try{n=r(d),u=!1}finally{u?X(a):$(a)}return ae(a,s),de(n,a)}else if(!t||typeof t!="object"){if(n=r(t),n===void 0&&(n=t),n===fe&&(n=void 0),this.autoFreeze_&&Z(n,!0),s){const a=[],d=[];b("Patches").generateReplacementPatches_(t,n,a,d),s(a,d)}return n}else x(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(d,...u)=>this.produceWithPatches(d,h=>t(h,...u));let s,n;return[this.produce(t,r,(d,u)=>{s=d,n=u}),s,n]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){j(e)||x(8),v(e)&&(e=$e(e));const t=le(this),r=Y(e,void 0);return r[p].isManual_=!0,$(t),r}finishDraft(e,t){const r=e&&e[p];(!r||!r.isManual_)&&x(9);const{scope_:s}=r;return ae(s,t),de(void 0,s)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const n=t[r];if(n.path.length===0&&n.op==="replace"){e=n.value;break}}r>-1&&(t=t.slice(r+1));const s=b("Patches").applyPatches_;return v(e)?s(e,t):this.produce(e,n=>s(n,t))}};function Y(e,t){const r=M(e)?b("MapSet").proxyMap_(e,t):B(e)?b("MapSet").proxySet_(e,t):Ge(e,t);return(t?t.scope_:xe()).drafts_.push(r),r}function $e(e){return v(e)||x(10,e),_e(e)}function _e(e){if(!j(e)||I(e))return e;const t=e[p];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=L(e,t.scope_.immer_.useStrictShallowCopy_)}else r=L(e,!0);return A(r,(s,n)=>{me(r,s,_e(n))}),t&&(t.finalized_=!1),r}var m=new Xe,S=m.produce;m.produceWithPatches.bind(m);m.setAutoFreeze.bind(m);m.setUseStrictShallowCopy.bind(m);m.applyPatches.bind(m);m.createDraft.bind(m);m.finishDraft.bind(m);function tt(){var te;const{t:e}=ke(),r=((te=Ce().state)==null?void 0:te.purchaseId)||null,{extendedPurchase:s,setExtendedPurchase:n}=y.exports.useContext(ze),{data:a,isPending:d}=Oe({queryKey:["purchases",{status:ne.inCart}],queryFn:()=>O.getPurchases({status:ne.inCart})}),u=a==null?void 0:a.data.data,h=Q({mutationFn:O.updatePurchase,onSuccess:()=>{n(o=>{const i=W.exports.keyBy(o,"_id");return o.map(l=>{var f;return{...l,disabled:!1,checked:Boolean((f=i[l._id])==null?void 0:f.checked)}})||[]})}}),C=Q({mutationFn:O.buyProducts,onSuccess:(o,i)=>{const l=i.map(f=>f.product_id);n(f=>f.filter(K=>!l.includes(K.product._id))),Fe.success(o.data.message,{position:"top-center",autoClose:1e3})}}),z=Q({mutationFn:O.deletePurchase,onSuccess:(o,i)=>{n(l=>l.filter(f=>!i.includes(f._id)))}}),R=y.exports.useMemo(()=>s.every(o=>o.checked),[s]),_=y.exports.useMemo(()=>s.filter(o=>o.checked),[s]),ee=_.length,ye=y.exports.useMemo(()=>_.reduce((o,i)=>o+i.product.price*i.buy_count,0),[_]),ge=y.exports.useMemo(()=>_.reduce((o,i)=>o+(i.product.price_before_discount-i.product.price)*i.buy_count,0),[_]);y.exports.useEffect(()=>{u&&n(o=>{const i=W.exports.keyBy(o,"_id");return u.map(l=>{var f;return{...l,disabled:!1,checked:l._id===r||Boolean((f=i[l._id])==null?void 0:f.checked)}})})},[u,r]);const je=o=>i=>{n(S(l=>{l[o].checked=i.target.checked}))},T=()=>{n(o=>o.map(i=>({...i,checked:!R})))},be=o=>i=>{n(S(l=>{l[o].buy_count=Number(i)}))},q=(o,i,l)=>{if(l){const f=s[o];n(S(K=>{K[o].buy_count=i})),Pe(f,o,i)}},Pe=y.exports.useCallback(W.exports.debounce((o,i,l)=>{n(S(f=>{f[i].disabled=!0})),h.mutate({product_id:o.product._id,buy_count:l})},1e3),[]),ve=o=>()=>{const i=s[o]._id;z.mutate([i])},Ne=()=>{const o=_.map(i=>i._id);z.mutate(o)},we=()=>{if(_.length>0){const o=_.map(i=>({product_id:i.product._id,buy_count:i.buy_count}));C.mutate(o)}};return c.exports.jsxs("div",{className:"bg-neutral-100 py-16",children:[c.exports.jsxs(Se,{children:[c.exports.jsxs("title",{children:[e("shopping cart")," | Shopee Clone"]}),c.exports.jsx("meta",{name:"description",content:"Gi\u1ECF h\xE0ng c\u1EE7a b\u1EA1n"})]}),c.exports.jsxs("div",{className:"container",children:[c.exports.jsx("div",{className:"overflow-auto",children:c.exports.jsxs("div",{className:"min-w-[1000px]",children:[c.exports.jsxs("div",{className:"grid grid-cols-12 rounded-sm bg-white py-5 px-9 text-sm capitalize text-gray-500 shadow",children:[c.exports.jsx("div",{className:"col-span-6",children:c.exports.jsxs("div",{className:"flex items-center",children:[c.exports.jsx("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:c.exports.jsx("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:R,onChange:T})}),c.exports.jsx("div",{className:"flex-grow text-black",children:e("product")})]})}),c.exports.jsx("div",{className:"col-span-6",children:c.exports.jsxs("div",{className:"grid grid-cols-5 text-center",children:[c.exports.jsx("div",{className:"col-span-2",children:e("unit price")}),c.exports.jsx("div",{className:"col-span-1",children:e("quantity")}),c.exports.jsx("div",{className:"col-span-1",children:e("total price")}),c.exports.jsx("div",{className:"col-span-1",children:e("actions")})]})})]}),c.exports.jsxs("div",{className:"my-3 rounded-sm bg-white p-5 shadow",children:[d&&Array(5).fill(0).map((o,i)=>c.exports.jsx(Me,{},i)),s.length>0&&s.map((o,i)=>c.exports.jsxs("div",{className:"mb-5 grid grid-cols-12 items-center rounded-sm border border-gray-200 bg-white py-5 px-4 text-center text-sm text-gray-500 first:mt-0",children:[c.exports.jsx("div",{className:"col-span-6",children:c.exports.jsxs("div",{className:"flex",children:[c.exports.jsx("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:c.exports.jsx("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:o.checked,onChange:je(i)})}),c.exports.jsx("div",{className:"flex-grow",children:c.exports.jsxs("div",{className:"flex",children:[c.exports.jsx(re,{className:"h-20 w-20 flex-shrink-0",to:se({name:o.product.name,id:o.product._id}),children:c.exports.jsx("img",{alt:o.product.name,src:o.product.image})}),c.exports.jsx("div",{className:"flex flex-grow items-center px-2 pt-1 pb-2",children:c.exports.jsx(re,{to:se({name:o.product.name,id:o.product._id}),className:"text-left line-clamp-2",children:o.product.name})})]})})]})}),c.exports.jsx("div",{className:"col-span-6",children:c.exports.jsxs("div",{className:"grid grid-cols-5 items-center",children:[c.exports.jsx("div",{className:"col-span-2",children:c.exports.jsxs("div",{className:"flex items-center justify-center",children:[c.exports.jsxs("span",{className:"text-gray-300 line-through",children:["\u20AB",N(o.product.price_before_discount)]}),c.exports.jsxs("span",{className:"ml-3",children:["\u20AB",N(o.product.price)]})]})}),c.exports.jsx("div",{className:"col-span-1",children:c.exports.jsx(Ee,{max:o.product.quantity,value:o.buy_count,classNameWrapper:"",onIncrease:l=>q(i,l,l<=o.product.quantity),onDecrease:l=>q(i,l,l>=1),onType:be(i),onFocusOut:l=>q(i,l,l>=1&&l<=o.product.quantity&&l!==s[i].buy_count),disabled:o.disabled})}),c.exports.jsx("div",{className:"col-span-1",children:c.exports.jsxs("span",{className:"text-orange",children:["\u20AB",N(o.product.price*(o.buy_count||0))]})}),c.exports.jsx("div",{className:"col-span-1",children:c.exports.jsx("button",{className:"bg-none text-black transition-colors hover:text-orange",onClick:ve(i),children:e("delete")})})]})})]},o._id))]}),s.length==0&&c.exports.jsxs("div",{className:"mt-[15px] flex h-[300px] flex-col items-center justify-center bg-white p-2",children:[c.exports.jsx("img",{src:Ae,alt:"no purchase",className:"h-[160px] w-[160px]"}),c.exports.jsx("div",{className:"mt-3 capitalize",children:e("no product")})]})]})}),c.exports.jsxs("div",{className:"sticky bottom-0 z-10 mt-8 flex flex-col rounded-sm border border-gray-100 bg-white p-5 shadow sm:flex-row sm:items-center",children:[c.exports.jsxs("div",{className:"flex items-center",children:[c.exports.jsx("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:c.exports.jsx("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:R,onChange:T})}),c.exports.jsxs("button",{className:"mx-3 border-none bg-none",onClick:T,children:[e("select all")," (",s.length,")"]}),c.exports.jsx("button",{className:"mx-3 border-none bg-none",onClick:Ne,children:e("delete")})]}),c.exports.jsxs("div",{className:"mt-5 flex flex-col sm:ml-auto sm:mt-0 sm:flex-row sm:items-center",children:[c.exports.jsxs("div",{children:[c.exports.jsxs("div",{className:"flex items-center sm:justify-end",children:[c.exports.jsxs("div",{children:[e("total pay")," (",ee," ",ee>1?e("items"):e("item"),"):"]}),c.exports.jsxs("div",{className:"ml-2 text-2xl text-orange",children:["\u20AB",N(ye)]})]}),c.exports.jsxs("div",{className:"flex items-center text-sm sm:justify-end",children:[c.exports.jsx("div",{className:"text-gray-500",children:e("saved")}),c.exports.jsxs("div",{className:"ml-6 text-orange",children:["\u20AB",N(ge)]})]})]}),c.exports.jsx(De,{className:"mt-5 flex h-10 w-52 items-center justify-center bg-red-500 text-sm uppercase text-white hover:bg-red-600 sm:ml-4 sm:mt-0",onClick:we,disabled:C.isPending,children:e("check out")})]})]})]})]})}export{tt as default};
