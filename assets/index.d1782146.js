import{Q as I,g as z,h as O,k as T,m as V,u as k,a as S,c as W,o as H,r as v,U as u,n as g,p as D,j as e,C as B,N as G,B as _,q as Z,L as P,s as L,t as N,v as $,P as K,w as U,W as y,x as M,H as J,y as X}from"./index.65d1c01f.js";import{P as F,p as R}from"./Product.64246c54.js";import{I as E}from"./InputNumber.7381c221.js";var Y=class extends I{constructor(s,t){super(s,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s,t){super.setOptions({...s,behavior:z()},t)}getOptimisticResult(s){return s.behavior=z(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,t){var x,l,o,d;const{state:r}=s,n=super.createResult(s,t),{isFetching:i,isRefetching:a}=n,c=i&&((l=(x=r.fetchMeta)==null?void 0:x.fetchMore)==null?void 0:l.direction)==="forward",p=i&&((d=(o=r.fetchMeta)==null?void 0:o.fetchMore)==null?void 0:d.direction)==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:O(t,r.data),hasPreviousPage:T(t,r.data),isFetchingNextPage:c,isFetchingPreviousPage:p,isRefetching:a&&!c&&!p}}};function q(s,t){return V(s,Y,t)}function ee({queryConfig:s}){var l;const{t}=k(),r=S(),{control:n,handleSubmit:i,trigger:a,reset:c,formState:{errors:p}}=W({defaultValues:{price_min:s.price_min||"",price_max:s.price_max||""},resolver:H(Z),shouldFocusError:!1});v.exports.useEffect(()=>{const{price_min:o,price_max:d}=s;!o&&!d&&c({price_min:"",price_max:""})},[s.price_min,s.price_max]);const x=i(o=>{const{price_min:d="",price_max:b=""}=o;r({pathname:u.productList,search:g(D({...s,price_min:d,price_max:b},w=>w==="")).toString()})});return e.exports.jsxs("form",{className:"mt-2",onSubmit:x,children:[e.exports.jsxs("div",{className:"flex items-start",children:[e.exports.jsx(B,{control:n,name:"price_min",render:({field:o})=>e.exports.jsx(E,{type:"text",className:"grow",placeholder:t("price min"),classNameInput:"p-1 w-full outline-none border border-gray-300 focus:border-gray-500 rounded-sm focus:shadow-sm",classNameError:"hidden",value:o.value,ref:o.ref,onChange:d=>{o.onChange(d),a("price_max")}})}),e.exports.jsx("div",{className:"mx-2 mt-2 shrink-0",children:"-"}),e.exports.jsx(B,{control:n,name:"price_max",render:({field:o})=>e.exports.jsx(E,{type:"text",className:"grow",placeholder:t("price max"),classNameInput:"p-1 w-full outline-none border border-gray-300 focus:border-gray-500 rounded-sm focus:shadow-sm",classNameError:"hidden",value:o.value,ref:o.ref,onChange:d=>{o.onChange(d),a("price_min")}})})]}),e.exports.jsx("div",{className:"mt-1 min-h-[1.25rem] text-center text-sm text-red-600",children:(l=p.price_min)!=null&&l.message?t(`${G}:${p.price_min.message}`):""}),e.exports.jsx(_,{className:"uppercase",block:!0,children:t("apply")})]})}function se({queryConfig:s}){const{t}=k(),r=S(),n=i=>{r({pathname:u.productList,search:g({...s,rating_filter:String(i)}).toString()})};return e.exports.jsx("ul",{className:"my-3",children:Array(5).fill(0).map((i,a)=>e.exports.jsx("li",{className:"py-1 pl-2",children:e.exports.jsxs("div",{className:"flex cursor-pointer items-center text-sm",onClick:()=>n(5-a),tabIndex:0,role:"button","aria-hidden":"true",children:[Array(5).fill(0).map((c,p)=>p<5-a?e.exports.jsxs("svg",{viewBox:"0 0 9.5 8",className:"mr-1 h-4 w-4",children:[e.exports.jsxs("defs",{children:[e.exports.jsxs("linearGradient",{id:"ratingStarGradient",x1:"50%",x2:"50%",y1:"0%",y2:"100%",children:[e.exports.jsx("stop",{offset:0,stopColor:"#ffca11"}),e.exports.jsx("stop",{offset:1,stopColor:"#ffad27"})]}),e.exports.jsx("polygon",{id:"ratingStar",points:"14.910357 6.35294118 12.4209136 7.66171903 12.896355 4.88968305 10.8823529 2.92651626 13.6656353 2.52208166 14.910357 0 16.1550787 2.52208166 18.9383611 2.92651626 16.924359 4.88968305 17.3998004 7.66171903"})]}),e.exports.jsx("g",{fill:"url(#ratingStarGradient)",fillRule:"evenodd",stroke:"none",strokeWidth:1,children:e.exports.jsx("g",{transform:"translate(-876 -1270)",children:e.exports.jsx("g",{transform:"translate(155 992)",children:e.exports.jsx("g",{transform:"translate(600 29)",children:e.exports.jsx("g",{transform:"translate(10 239)",children:e.exports.jsx("g",{transform:"translate(101 10)",children:e.exports.jsx("use",{stroke:"#ffa727",strokeWidth:".5",xlinkHref:"#ratingStar"})})})})})})})]},p):e.exports.jsxs("svg",{viewBox:"0 0 30 30",className:"mr-1 h-4 w-4",children:[e.exports.jsx("defs",{children:e.exports.jsxs("linearGradient",{id:"star__hollow",x1:"50%",x2:"50%",y1:"0%",y2:"99.0177926%",children:[e.exports.jsx("stop",{offset:"0%",stopColor:"#FFD211"}),e.exports.jsx("stop",{offset:"100%",stopColor:"#FFAD27"})]})}),e.exports.jsx("path",{fill:"none",fillRule:"evenodd",stroke:"url(#star__hollow)",strokeWidth:2,d:"M23.226809 28.390899l-1.543364-9.5505903 6.600997-6.8291523-9.116272-1.4059447-4.01304-8.63019038-4.013041 8.63019038-9.116271 1.4059447 6.600997 6.8291523-1.543364 9.5505903 8.071679-4.5038874 8.071679 4.5038874z"})]},p)),a!==0&&e.exports.jsx("span",{children:t("rating up")})]})},a))})}function te({queryConfig:s,categories:t}){const{t:r}=k(),{category:n}=s,i=S(),a=()=>{i({pathname:u.productList,search:g(L(s,["category","price_min","price_max","rating_filter"])).toString()})};return e.exports.jsxs("div",{className:"sticky top-[120px] py-4",children:[e.exports.jsxs(P,{to:{pathname:u.productList,search:g(L(s,["category"])).toString()},className:N("flex items-center text-sm font-bold md:text-lg",{"text-orange":!n}),children:[e.exports.jsx("svg",{viewBox:"0 0 12 10",className:"mr-3 h-4 w-3 fill-current",children:e.exports.jsx("g",{fillRule:"evenodd",stroke:"none",strokeWidth:1,children:e.exports.jsx("g",{transform:"translate(-373 -208)",children:e.exports.jsx("g",{transform:"translate(155 191)",children:e.exports.jsxs("g",{transform:"translate(218 17)",children:[e.exports.jsx("path",{d:"m0 2h2v-2h-2zm4 0h7.1519633v-2h-7.1519633z"}),e.exports.jsx("path",{d:"m0 6h2v-2h-2zm4 0h7.1519633v-2h-7.1519633z"}),e.exports.jsx("path",{d:"m0 10h2v-2h-2zm4 0h7.1519633v-2h-7.1519633z"})]})})})})}),r("all categories")]}),e.exports.jsx("div",{className:"my-4 h-[1px] bg-gray-300"}),e.exports.jsx("ul",{children:t.map(c=>{const p=n===c._id;return e.exports.jsx("li",{className:"py-2 pl-2",children:e.exports.jsxs(P,{to:{pathname:u.productList,search:g({...s,category:c._id}).toString()},className:N("relative px-2",{"font-semibold text-orange":p}),children:[e.exports.jsx("svg",{viewBox:"0 0 4 7",className:"absolute left-[-10px] top-1 h-2 w-2 fill-orange",children:e.exports.jsx("polygon",{points:"4 3.5 0 0 0 7"})}),c.name]})},c._id)})}),e.exports.jsxs("div",{className:"mt-4 flex items-center text-xs font-bold uppercase md:text-sm lg:text-lg",children:[e.exports.jsx("svg",{enableBackground:"new 0 0 15 15",viewBox:"0 0 15 15",x:0,y:0,className:"mr-3 h-4 w-3 fill-current stroke-current",children:e.exports.jsx("g",{children:e.exports.jsx("polyline",{fill:"none",points:"5.5 13.2 5.5 5.8 1.5 1.2 13.5 1.2 9.5 5.8 9.5 10.2",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:10})})}),r("filter search")]}),e.exports.jsx("div",{className:"my-4 h-[1px] bg-gray-300"}),e.exports.jsxs("div",{className:"my-5",children:[e.exports.jsx("div",{children:r("price range")}),e.exports.jsx(ee,{queryConfig:s})]}),e.exports.jsx("div",{className:"my-4 h-[1px] bg-gray-300"}),e.exports.jsx("div",{className:"text-sm",children:r("rating")}),e.exports.jsx(se,{queryConfig:s}),e.exports.jsx("div",{className:"my-4 h-[1px] bg-gray-300"}),e.exports.jsx(_,{block:!0,className:"uppercase",onClick:a,children:r("clear all")})]})}const m={createdAt:"createdAt",view:"view",sold:"sold",price:"price"},C={asc:"asc",desc:"desc"};function re({queryConfig:s}){const{t}=k(),r=S(),{sort_by:n=m.createdAt,order:i}=s,a=x=>n===x,c=x=>{r({pathname:u.productList,search:g(L({...s,sort_by:x},["order"])).toString()})},p=x=>{r({pathname:u.productList,search:g({...s,sort_by:m.price,order:x}).toString()})};return e.exports.jsx("div",{className:"sticky top-[116px] z-20 bg-gray-100 px-3 py-4 shadow-sm",children:e.exports.jsx("div",{className:"flex flex-wrap items-center justify-between gap-2",children:e.exports.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.exports.jsx("div",{className:"text-xs md:text-sm",children:t("sort by")}),e.exports.jsx(_,{size:"small",onClick:()=>c(m.view),buttonType:a(m.view)?"primary":"secondary",className:"h-8 px-4 capitalize",children:t("popular")}),e.exports.jsx(_,{size:"small",onClick:()=>c(m.createdAt),buttonType:a(m.createdAt)?"primary":"secondary",className:"h-8 px-4 capitalize",children:t("latest")}),e.exports.jsx(_,{size:"small",onClick:()=>c(m.sold),buttonType:a(m.sold)?"primary":"secondary",className:"h-8 px-4 capitalize",children:t("top sales")}),e.exports.jsxs("select",{className:N("h-8  px-4 text-left text-xs capitalize outline-none md:text-sm",{"bg-orange text-white hover:bg-orange/80":a(m.price),"bg-white text-black hover:bg-slate-100":!a(m.price)}),value:i||"",onChange:x=>p(x.target.value),children:[e.exports.jsx("option",{value:"",disabled:!0,className:"bg-white text-black",children:t("price")}),e.exports.jsx("option",{value:C.asc,className:"bg-white text-black",children:t("price low to high")}),e.exports.jsx("option",{value:C.desc,className:"bg-white text-black",children:t("price high to low")})]})]})})})}const h=2;function ae({queryConfig:s,pageSize:t}){const r=Number(s.page),n=()=>{let i=!1,a=!1;const c=x=>a?null:(a=!0,e.exports.jsx("span",{className:"mx-2 rounded border bg-white px-3 py-2 shadow-sm",children:"..."},x)),p=x=>i?null:(i=!0,e.exports.jsx("span",{className:"mx-2 rounded border bg-white px-3 py-2 shadow-sm",children:"..."},x));return Array(t).fill(0).map((x,l)=>{const o=l+1;if(r<=h*2+1&&o>r+h&&o<t-h+1)return p(l);if(r>h*2+1&&r<t-h*2){if(o<r-h&&o>h)return c(l);if(o>r+h&&o<t-h+1)return p(l)}else if(r>=t-h*2&&o>h&&o<r-h)return c(l);return e.exports.jsx(P,{to:{pathname:u.productList,search:g({...s,page:o.toString()}).toString()},className:N("mx-2 cursor-pointer rounded border bg-white px-3 py-2 shadow-sm",{"border-cyan-500":o===r,"border-transparent":o!==r}),children:o},l)})};return e.exports.jsxs("div",{className:"mt-6 flex flex-wrap justify-center",children:[r===1?e.exports.jsx("span",{className:"mx-2 cursor-not-allowed rounded border bg-white/60 px-3 py-2  shadow-sm",children:"Prev"}):e.exports.jsx(P,{to:{pathname:u.productList,search:g({...s,page:(r-1).toString()}).toString()},className:"mx-2 cursor-pointer rounded border bg-white px-3 py-2  shadow-sm",children:"Prev"}),n(),r===t?e.exports.jsx("span",{className:"mx-2 cursor-not-allowed rounded border bg-white/60 px-3 py-2  shadow-sm",children:"Next"}):e.exports.jsx(P,{to:{pathname:u.productList,search:g({...s,page:(r+1).toString()}).toString()},className:"mx-2 cursor-pointer rounded border bg-white px-3 py-2  shadow-sm",children:"Next"})]})}const oe={getCategories(){return $.get(K.categories)}},ne=oe,ie="/shopeeclone/assets/empty.27da84ba.png";function ce(){return e.exports.jsxs("div",{className:"h-full animate-pulse overflow-hidden rounded-sm bg-white shadow transition-transform duration-100 hover:translate-y-[-0.04rem] hover:shadow-md",children:[e.exports.jsx("div",{className:"flex h-48 items-center justify-center bg-gray-300",children:e.exports.jsxs("svg",{className:"h-10 w-10 bg-gray-300 object-cover text-gray-200","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 20",children:[e.exports.jsx("path",{d:"M14.066 0H7v5a2 2 0 0 1-2 2H0v11a1.97 1.97 0 0 0 1.934 2h12.132A1.97 1.97 0 0 0 16 18V2a1.97 1.97 0 0 0-1.934-2ZM10.5 6a1.5 1.5 0 1 1 0 2.999A1.5 1.5 0 0 1 10.5 6Zm2.221 10.515a1 1 0 0 1-.858.485h-8a1 1 0 0 1-.9-1.43L5.6 10.039a.978.978 0 0 1 .936-.57 1 1 0 0 1 .9.632l1.181 2.981.541-1a.945.945 0 0 1 .883-.522 1 1 0 0 1 .879.529l1.832 3.438a1 1 0 0 1-.031.988Z"}),e.exports.jsx("path",{d:"M5 5V.13a2.96 2.96 0 0 0-1.293.749L.879 3.707A2.98 2.98 0 0 0 .13 5H5Z"})]})}),e.exports.jsxs("div",{className:"overflow-hidden p-2",children:[e.exports.jsx("div",{className:"mb-[12px] h-2 rounded-full bg-gray-200"}),e.exports.jsx("div",{className:"mb-[12px] h-2 rounded-full bg-gray-200"}),e.exports.jsx("div",{className:"mb-[12px] h-2 rounded-full bg-gray-200"}),e.exports.jsx("div",{className:"h-2 rounded-full bg-gray-200"})]})]})}function le(s={threshold:1}){const t=v.exports.useRef(null),[r,n]=v.exports.useState(!1),i=a=>{const[c]=a;n(c.isIntersecting)};return v.exports.useEffect(()=>{const a=new IntersectionObserver(i,s);return t.current&&a.observe(t.current),()=>{t.current&&a.unobserve(t.current)}},[t,s]),{isVisible:r,ref:t}}function he(){const{isVisible:s,ref:t}=le(),{t:r}=k(),n=U(),i=!1,[a,c]=v.exports.useState(y.pagination),[p,x]=v.exports.useState(0),l=a===y.pagination?M({queryKey:["products",n],queryFn:()=>(window.scrollTo(0,0),R.getProducts(n)),placeholderData:X,staleTime:3*60*1e3}):q({queryKey:["products",n],queryFn:async({pageParam:f})=>{const j=await R.getProducts({...n,page:f});return p==0&&x(j.data.data.pagination.page_size),j.data.data.products},initialPageParam:1,getNextPageParam:(f,j)=>j.length<p?j.length+1:void 0}),{data:o}=M({queryKey:["categories"],queryFn:()=>ne.getCategories()});v.exports.useEffect(()=>{a===y.scroll&&s&&l.hasNextPage&&l.fetchNextPage()},[s,a]),console.log("isVisible",s);const d=e.exports.jsxs(J,{children:[e.exports.jsxs("title",{children:[r("home")," | Shopee Clone"]}),e.exports.jsx("meta",{name:"description",content:"Trang ch\u1EE7 d\u1EF1 \xE1n Shopee Clone"})]});if(!l.data)return d;const b=a===y.pagination?l.data.data.data.products:l.data.pages,w=b.length>0||b.length==0&&(n.price_min||n.price_max||n.rating_filter||n.category);return e.exports.jsxs("div",{className:"bg-gray-200 py-6",children:[d,e.exports.jsx("div",{className:"container",children:e.exports.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[w&&e.exports.jsx("div",{className:N({"col-span-3":i,"col-span-4":!i}),children:e.exports.jsx(te,{queryConfig:{...n,page:"1"},categories:(o==null?void 0:o.data.data)||[]})}),b.length>0&&e.exports.jsxs("div",{className:N({"col-span-9":i,"col-span-8":!i}),children:[e.exports.jsx(re,{queryConfig:n}),a===y.pagination&&e.exports.jsxs(v.exports.Fragment,{children:[e.exports.jsx("div",{className:"mt-6 grid grid-cols-2 gap-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5",children:b.map(f=>e.exports.jsx("div",{className:"col-span-1",children:e.exports.jsx(F,{product:f})},f._id))}),e.exports.jsx(ae,{queryConfig:n,pageSize:l.data.data.data.pagination.page_size})]}),a===y.scroll&&e.exports.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5",children:[b.map((f,j)=>e.exports.jsx(v.exports.Fragment,{children:f.map((A,Q)=>e.exports.jsx("div",{className:"col-span-1",children:f.length===Q+1?e.exports.jsx(F,{product:A,ref:t}):e.exports.jsx(F,{product:A})},A._id))},j)),l.isFetchingNextPage&&Array(5).fill(0).map((f,j)=>e.exports.jsx("div",{className:"col-span-1 bg-white",children:e.exports.jsx(ce,{})},j))]})]}),b.length==0&&e.exports.jsx("div",{className:N({"col-span-9":w,"col-span-12":!w}),children:e.exports.jsxs("div",{className:"flex h-[500px] flex-col items-center justify-center  p-2",children:[e.exports.jsx("img",{src:ie,alt:"no purchase",className:"h-[160px] w-[160px]"}),e.exports.jsx("div",{className:"mt-3 capitalize",children:r("no_result_found")})]})})]})})]})}export{he as default};
