import{E as T,F as G,_ as $,G as q,u as _,r as m,j as e,I as L,A as Y,c as V,o as H,d as A,x as J,J as K,H as X,C as D,K as Q,M as Z,e as W}from"./index.b9331833.js";import{B as ee}from"./Button.07b4bcfb.js";import{I as S}from"./Input.c8bc9263.js";import{u as v}from"./user.api.7fbba0a1.js";import{I as se}from"./InputNumber.335f2ffb.js";import{t as te}from"./toNumber.95276222.js";var re=Math.ceil,ae=Math.max;function oe(s,t,r,a){for(var x=-1,d=ae(re((t-s)/(r||1)),0),i=Array(d);d--;)i[a?d:++x]=s,s+=r;return i}var ne=oe,ie=T,le=G,de=$,ce=q;function xe(s,t,r){if(!ce(r))return!1;var a=typeof t;return(a=="number"?le(r)&&de(t,r.length):a=="string"&&t in r)?ie(r[t],s):!1}var me=xe,pe=te,R=1/0,he=17976931348623157e292;function ue(s){if(!s)return s===0?s:0;if(s=pe(s),s===R||s===-R){var t=s<0?-1:1;return t*he}return s===s?s:0}var fe=ue,ge=ne,be=me,N=fe;function je(s){return function(t,r,a){return a&&typeof a!="number"&&be(t,r,a)&&(r=a=void 0),t=N(t),r===void 0?(r=t,t=0):r=N(r),a=a===void 0?t<r?1:-1:N(a),ge(t,r,a,s)}}var we=je,ve=we,Ne=ve(),ye=Ne;const y=ye;function _e({value:s,onChange:t,errorMessage:r}){const{t:a}=_(),[x,d]=m.exports.useState({date:f.getDate(),month:f.getMonth(),year:f.getFullYear()});m.exports.useEffect(()=>{s&&d({date:s.getDate(),month:s.getMonth(),year:s.getFullYear()})},[s]);const i=n=>{const{value:c,name:g}=n.target,h={...x,[g]:c};d(h),t&&t(new Date(h.year,h.month,h.date))};return e.exports.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:a("date of birth")}),e.exports.jsxs("div",{className:"sm:w-[80%] sm:pl-5",children:[e.exports.jsxs("div",{className:"flex justify-between",children:[e.exports.jsxs("select",{onChange:i,name:"date",className:"h-10 w-[32%] rounded-sm border border-black/10 px-3",value:(s==null?void 0:s.getDate())||x.date,children:[e.exports.jsx("option",{disabled:!0,children:a("day")}),y(1,32).map(n=>e.exports.jsx("option",{value:n,children:n},n))]}),e.exports.jsxs("select",{onChange:i,name:"month",className:"h-10 w-[32%] rounded-sm border border-black/10 px-3",value:(s==null?void 0:s.getMonth())||x.month,children:[e.exports.jsx("option",{disabled:!0,children:a("month")}),y(0,12).map(n=>e.exports.jsx("option",{value:n,children:n+1},n))]}),e.exports.jsxs("select",{onChange:i,name:"year",className:"h-10 w-[32%] rounded-sm border border-black/10 px-3",value:(s==null?void 0:s.getFullYear())||x.year,children:[e.exports.jsx("option",{disabled:!0,children:a("year")}),y(1950,2025).map(n=>e.exports.jsx("option",{value:n,children:n},n))]})]}),e.exports.jsx("div",{className:"mt-1 min-h-[1.25rem] text-sm text-red-600",children:r})]})]})}const Ce=1048576;function Ie({onChange:s}){const{t}=_(),r=m.exports.useRef(null),a=d=>{var i;d.preventDefault(),(i=r.current)==null||i.click()},x=d=>{var n;const i=(n=d.target.files)==null?void 0:n[0];i&&(i.size>=Ce||!i.type.includes("image"))?L.error("D\u1EE5ng l\u01B0\u1EE3ng file t\u1ED1i \u0111a 1 MB. \u0110\u1ECBnh d\u1EA1ng:.JPEG, .PNG",{position:"top-center"}):s&&s(i)};return e.exports.jsxs(m.exports.Fragment,{children:[e.exports.jsx("input",{className:"hidden",type:"file",accept:".jpg,.jpeg,.png",ref:r,onChange:x,onClick:d=>d.target.value=null}),e.exports.jsx("button",{className:"flex h-10 items-center justify-end rounded-sm border bg-white px-6 text-sm text-gray-600 shadow-sm",onClick:a,children:t("select image")})]})}const Ee=Z.pick(["name","address","phone","date_of_birth","avatar"]),f=new Date(1990,0,1);function Pe(){const{t:s}=_(),[t,r]=m.exports.useState(),a=m.exports.useMemo(()=>t?URL.createObjectURL(t):"",[t]),{setProfile:x}=m.exports.useContext(Y),{control:d,register:i,handleSubmit:n,setValue:c,watch:g,formState:{errors:h,isValid:P}}=V({defaultValues:{name:"",phone:"",address:"",avatar:"",date_of_birth:f},resolver:H(Ee),mode:"onBlur"}),C=A({mutationFn:v.updateProfile,onSuccess:l=>{L.success(l.data.message,{position:"top-center",autoClose:1e3})}}),I=A({mutationFn:v.uploadAvatar}),{data:w,refetch:k}=J({queryKey:["profile"],queryFn:v.getProfile}),o=w==null?void 0:w.data.data,E=g("avatar"),z=()=>{const{name:l,phone:j,address:p,date_of_birth:u}=g();return o&&l===o.name&&j===o.phone&&p===o.address&&E===o.avatar&&(u==null?void 0:u.toISOString())===o.date_of_birth},F=C.isPending||I.isPending,B=F||!P||z();m.exports.useEffect(()=>{o&&(c("name",o.name),c("phone",o.phone),c("address",o.address),c("avatar",o.avatar),c("date_of_birth",o.date_of_birth?new Date(o.date_of_birth):f))},[o]);const U=l=>{r(l),c("avatar",URL.createObjectURL(l))},O=n(async l=>{var j;try{let p=E;if(t){const M=new FormData;M.append("image",t),p=(await I.mutateAsync(M)).data.data,c("avatar",p)}const u=await C.mutateAsync({...l,avatar:p,date_of_birth:(j=l.date_of_birth)==null?void 0:j.toISOString()});x(u.data.data),K(u.data.data),k()}catch(p){console.log(p)}}),b=l=>W(h,l);return e.exports.jsxs("div",{className:"rounded-sm bg-white px-2 pb-10 shadow md:px-7 md:pb-20",children:[e.exports.jsxs(X,{children:[e.exports.jsxs("title",{children:[s("my profile")," | Shopee Clone"]}),e.exports.jsx("meta",{name:"description",content:"Trang th\xF4ng tin c\xE1 nh\xE2n"})]}),e.exports.jsxs("div",{className:"border-b border-b-gray-200 py-6",children:[e.exports.jsx("h1",{className:"text-lg font-medium capitalize text-gray-900",children:s("my profile")}),e.exports.jsx("div",{className:"mt-1 text-sm text-gray-700",children:s("protect account")})]}),e.exports.jsxs("form",{className:"mt-8 flex flex-col-reverse md:flex-row md:items-start",onSubmit:O,children:[e.exports.jsxs("div",{className:"mt-6 flex-grow md:mt-0 md:pr-12",children:[e.exports.jsxs("div",{className:"flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:s("email")}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx("div",{className:"pt-3 text-gray-700",children:o==null?void 0:o.email})})]}),e.exports.jsxs("div",{className:"mt-6 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:s("name")}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx(S,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",name:"name",placeholder:s("name"),errorMessage:b("name"),setValue:c,register:i})})]}),e.exports.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:s("phone")}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx(D,{control:d,name:"phone",render:({field:l})=>e.exports.jsx(se,{type:"text",placeholder:s("phone"),classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",errorMessage:b("phone"),...l,onChange:l.onChange})})})]}),e.exports.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:s("address")}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx(S,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",name:"address",placeholder:s("address"),errorMessage:b("address"),setValue:c,register:i})})]}),e.exports.jsx(D,{control:d,name:"date_of_birth",render:({field:l})=>e.exports.jsx(_e,{errorMessage:b("date_of_birth"),value:l.value,onChange:l.onChange})}),e.exports.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[e.exports.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right"}),e.exports.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:e.exports.jsx(ee,{className:"flex h-9 items-center rounded-sm bg-orange px-5 text-center text-sm text-white hover:bg-orange/80",type:"submit",isLoading:F,disabled:B,children:s("save")})})]})]}),e.exports.jsx("div",{className:"flex justify-center md:w-72 md:border-l md:border-l-gray-200",children:e.exports.jsxs("div",{className:"flex flex-col items-center",children:[e.exports.jsx("div",{className:"my-5 h-24 w-24",children:e.exports.jsx("img",{src:a||Q(o==null?void 0:o.avatar),alt:"",className:"h-full w-full rounded-full border border-black/10 object-cover"})}),e.exports.jsx(Ie,{onChange:U}),e.exports.jsxs("div",{className:"mt-3 text-gray-400",children:[e.exports.jsx("div",{children:s("file size max")}),e.exports.jsx("div",{children:s("file extension format")})]})]})})]})]})}export{Pe as default};
